var U=Object.defineProperty;var Z=(o,e,r)=>e in o?U(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r;var s=(o,e,r)=>(Z(o,typeof e!="symbol"?e+"":e,r),r);import{a as b,C as y,S as u,b as m,F as h,V as v,G,c as E,p as P,r as D,g as J,d as R,e as q,M as B,f as K,T as W,O as Q,h as X,i as Y,j as x,k as j,P as z}from"./vendor.9e2f2b41.js";const $=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerpolicy&&(l.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?l.credentials="include":t.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(t){if(t.ep)return;t.ep=!0;const l=r(t);fetch(t.href,l)}};$();const w="http://mpm-tlc.ns0.it:4000";function ee(o,e,r,n){return b.get(w+"/grid/"+o+"/"+e+"/"+r+"/"+n)}function te(o){return b.post(w+"/start",o)}function oe(o){var e="/stop";return b.post(w+e,{simulationId:o})}function ne(o){var e="/snapshot/"+parseInt(o);return console.log(e),b.get(w+e)}class re extends y{constructor(e,r,n){const t=e||{},l=document.createElement("button");l.innerHTML="Ottieni griglia";const i=document.createElement("div");i.className="ol-control ol-control-disabled ctrl-get-grid",i.appendChild(l);super({element:i,target:t.target});s(this,"x0",0);s(this,"y0",0);s(this,"xn",0);s(this,"yn",0);s(this,"map");s(this,"disabled",!0);s(this,"addMarker");s(this,"deleteGridController");this.addMarker=r,this.deleteGridController=n,l.addEventListener("click",this.handleGetGrid.bind(this),!1)}handleGetGrid(){const e={Polygon:new u({stroke:new m({color:"blue",width:1}),fill:new h({color:"rgba(0, 0, 0, 0.1)"})})},r=function(n){return e[n.getGeometry().getType()]};ee(this.x0,this.y0,this.xn,this.yn).then(n=>{var t=n.data;if(t.features.length==0)return;const l=new v({features:new G().readFeatures(t)}),i=new E({source:l,style:r});i.set("id",123),this.map.addLayer(i),this.map.un("singleclick",this.addMarker),this.map.getLayers().getArray().filter(d=>d.get("id")==456).forEach(d=>this.map.removeLayer(d)),this.deleteGridController.enableControl(),this.disableControl()}).catch(n=>{console.error(n)})}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-get-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-get-grid"}}class le extends y{constructor(e,r){const n=e||{},t=document.createElement("button");t.innerHTML="Pulisci";const l=document.createElement("div");l.className="ol-control ctrl-undo",l.appendChild(t);super({element:l,target:n.target});s(this,"stack",[]);s(this,"startSimulationController",0);this.startSimulationController=r,t.addEventListener("click",this.handleUndo.bind(this),!1)}handleUndo(){if(this.stack.length>0){console.log(this.stack);let e=this.stack.pop();console.log(this.stack),this.stack.length>0?this.startSimulationController.enableControl():this.startSimulationController.disableControl(),e.setStyle(new u({stroke:new m({color:"blue",width:1}),fill:new h({color:"rgba(0, 0, 0, 0.1)"})}))}else this.startSimulationController.disableControl()}}class se extends y{constructor(e){const r=e||{},n=document.createElement("button");n.innerHTML="Inizia simulazione";const t=document.createElement("div");t.className="ol-control ol-control-disabled ctrl-start-simulation",t.appendChild(n);super({element:t,target:r.target});s(this,"initState");s(this,"disabled",!0);s(this,"simulationId");s(this,"timer");s(this,"map");this.element=t,n.addEventListener("click",this.handleStartSimulation.bind(this),!1)}handleStartSimulation(){var e=this.map.getLayers().getArray().filter(n=>n.get("id")==123)[0];console.log(e),console.log(e.getSource().getFeatures()),console.log(e.getSource());var r=JSON.parse(new G().writeFeatures(e.getSource().getFeatures()));console.log(r),te(r).then(n=>{console.log(n),this.simulationId=n.data;const t=document.createElement("button");t.innerHTML="Ferma simulazione",this.element.className="ol-control ctrl-stop-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(t),t.addEventListener("click",this.stop.bind(this),!1),this.timer=setTimeout(()=>{this.refresh()},5e3)}).catch(n=>{console.log(n)})}refresh(){var e=new u({stroke:new m({color:"blue",width:1}),fill:new h}),r=function(n){var t=n.get("fire"),l=t==1?"rgba(255, 0, 0, 0.3)":"rgba(0, 0, 0, 0.1)";return e.getFill().setColor(l),e};ne(this.simulationId).then(n=>{var t=n.data;console.log(t);const l=new v({features:new G().readFeatures(t)}),i=new E({source:l,style:r});i.set("id",123),this.map.getLayers().getArray().filter(d=>d.get("id")==123).forEach(d=>this.map.removeLayer(d)),this.map.addLayer(i),this.timer=setTimeout(()=>{this.refresh()},5e3)}).catch(n=>{console.log(n)})}stop(){oe(this.simulationId).then(e=>{this.timer!=null&&(clearTimeout(this.timer),this.timer=0);const r=document.createElement("button");r.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(r),r.addEventListener("click",this.handleStartSimulation.bind(this),!1)}).catch(e=>{this.timer!=0&&(clearTimeout(this.timer),this.timer=0);const r=document.createElement("button");r.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(r),console.error(e)})}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-start-simulation"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-start-simulation"}}class ie extends y{constructor(e,r){const n=e||{},t=document.createElement("button");t.innerHTML="Cancella griglia";const l=document.createElement("div");l.className="ol-control ol-control-disabled ctrl-delete-grid",l.appendChild(t);super({element:l,target:n.target});s(this,"map");s(this,"addMarker");s(this,"getGridController");this.addMarker=r,t.addEventListener("click",this.handleDeleteGrid.bind(this),!1)}handleDeleteGrid(){this.map.getLayers().getArray().filter(e=>e.get("id")==123).forEach(e=>this.map.removeLayer(e)),this.map.on("singleclick",this.addMarker),this.disableControl(),this.getGridController.disableControl()}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-delete-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-delete-grid"}}let ae="3035",ce="+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",C=[84.17,-35.58,24.6,44.83];const I="EPSG:"+ae,F=function(o){if(console.log("coordinates: "+o.coordinate),g<2){const e=new x({geometry:new z(o.coordinate),name:"Point"});e.setStyle(he),N.addFeature(e),T.setSource(N),T.set("id",456),g+=1,g==1?(c.x0=o.coordinate[0],c.y0=o.coordinate[1]):g==2&&(c.xn=o.coordinate[0],c.yn=o.coordinate[1],c.enableControl())}else g>=2&&(g=0,N.clear(),c.disableControl())};P.defs(I,ce);D(P);const f=J(I),de=R("EPSG:4326",f);let O=[C[1],C[2],C[3],C[0]];f.setWorldExtent(O);const A=q(O,de,void 0,8);f.setExtent(A);let S=new se,k=new ie("",F),c=new re("",F,k),L=new le("",S);const a=new B({controls:K().extend([c,k,L,S]),layers:[new W({source:new Q})],target:"map",view:new X({projection:f,center:[4559505,2121005],extent:A,zoom:16})});k.getGridController=c;k.map=a;c.map=a;S.map=a;const p=new Y({trackingOptions:{enableHighAccuracy:!0},projection:f});p.setTracking(!0);const ue=new x;p.on("change:accuracyGeometry",function(){ue.setGeometry(p.getAccuracyGeometry())});const H=new x;H.setStyle(new u({image:new j({radius:6,fill:new h({color:"#3399CC"}),stroke:new m({color:"#fff",width:2})})}));p.on("change:position",function(){const o=p.getPosition();H.setGeometry(o?new z(o):null)});var M=a.getView().getZoom();console.log(M);a.on("moveend",function(o){var e=a.getView().getZoom();M!=e&&(console.log("zoom end, new zoom: "+e),M=e)});const me=function(o){let e=a.getFeaturesAtPixel(o);e[0]!=null&&((e[0].getStyle()==null||e[0].getStyle()!=null&&e[0].getStyle().fill_.color_=="rgba(0, 0, 0, 0.1)")&&L.stack.push(e[0]),L.stack.length>0&&S.enableControl(),e[0].setStyle(new u({stroke:new m({color:"blue",width:1}),fill:new h({color:"rgba(255, 0, 0, 0.3)"})})),e[0].setProperties({fire:1}))};a.on("click",function(o){me(o.pixel)});const _=new h({color:"rgba(255,255,255,0.4)"}),V=new m({color:"#3399CC",width:1.25}),he=new u({image:new j({fill:_,stroke:V,radius:5}),fill:_,stroke:V}),N=new v({features:[]}),T=new E;a.addLayer(T);let g=0;a.on("singleclick",F);
//# sourceMappingURL=index.3c51405a.js.map
