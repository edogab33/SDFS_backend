var Z=Object.defineProperty;var D=(r,e,l)=>e in r?Z(r,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[e]=l;var i=(r,e,l)=>(D(r,typeof e!="symbol"?e+"":e,l),l);import{a as y,C as m,S as u,b as h,F as p,V as E,G,c as M,p as F,r as J,g as R,d as q,e as K,M as W,f as Q,T as X,O as Y,h as $,i as ee,j as x,k as P,P as j}from"./vendor.9e2f2b41.js";const te=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}};te();const S="http://mpm-tlc.ns0.it:4000";function oe(r,e,l,o){return y.get(S+"/grid/"+r+"/"+e+"/"+l+"/"+o)}function ne(r){return y.post(S+"/start",r)}function le(r){var e="/stop";return y.post(S+e,{simulationId:r})}function re(r,e){console.log(e),console.log(parseInt(e));var l="/snapshot/"+parseInt(r)+"/"+parseInt(e);return console.log(l),y.get(S+l)}class ie extends m{constructor(e,l,o){const t=e||{},n=document.createElement("button");n.innerHTML="Ottieni griglia";const s=document.createElement("div");s.className="ol-control ol-control-disabled ctrl-get-grid",s.appendChild(n);super({element:s,target:t.target});i(this,"x0",0);i(this,"y0",0);i(this,"xn",0);i(this,"yn",0);i(this,"map");i(this,"disabled",!0);i(this,"addMarker");i(this,"deleteGridController");this.addMarker=l,this.deleteGridController=o,n.addEventListener("click",this.handleGetGrid.bind(this),!1)}handleGetGrid(){const e={Polygon:new u({stroke:new h({color:"blue",width:1}),fill:new p({color:"rgba(0, 0, 0, 0.1)"})})},l=function(o){return e[o.getGeometry().getType()]};oe(this.x0,this.y0,this.xn,this.yn).then(o=>{var t=o.data;if(t.features.length==0)return;const n=new E({features:new G().readFeatures(t)}),s=new M({source:n,style:l});s.set("id",123),this.map.addLayer(s),this.map.un("singleclick",this.addMarker),this.map.getLayers().getArray().filter(d=>d.get("id")==456).forEach(d=>this.map.removeLayer(d)),this.deleteGridController.enableControl(),this.disableControl()}).catch(o=>{console.error(o)})}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-get-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-get-grid"}}class se extends m{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Pulisci";const n=document.createElement("div");n.className="ol-control ctrl-undo",n.appendChild(t);super({element:n,target:o.target});i(this,"stack",[]);i(this,"startSimulationController",0);this.startSimulationController=l,t.addEventListener("click",this.handleUndo.bind(this),!1)}handleUndo(){if(this.stack.length>0){console.log(this.stack);let e=this.stack.pop();console.log(this.stack),this.stack.length>0?this.startSimulationController.enableControl():this.startSimulationController.disableControl(),e.setStyle(new u({stroke:new h({color:"blue",width:1}),fill:new p({color:"rgba(0, 0, 0, 0.1)"})}))}else this.startSimulationController.disableControl()}}class ae extends m{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Inizia simulazione";const n=document.createElement("div");n.className="ol-control ol-control-disabled ctrl-start-simulation",n.appendChild(t);super({element:n,target:o.target});i(this,"initState");i(this,"disabled",!0);i(this,"simulationId");i(this,"timer");i(this,"map");i(this,"horizonControl");i(this,"getSnapshotControl");this.element=n,this.horizonControl=l,t.addEventListener("click",this.handleStartSimulation.bind(this),!1)}handleStartSimulation(){var e=this.map.getLayers().getArray().filter(o=>o.get("id")==123)[0],l=JSON.parse(new G().writeFeatures(e.getSource().getFeatures()));l.horizon=this.horizonControl.val.innerHTML,ne(l).then(o=>{console.log("Simulation started:"),console.log(o),this.simulationId=o.data;const t=document.createElement("button");t.innerHTML="Ferma simulazione",this.element.className="ol-control ctrl-stop-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(t),t.addEventListener("click",this.stop.bind(this),!1),this.getSnapshotControl.simulationId=this.simulationId,this.getSnapshotControl.enableControl()}).catch(o=>{console.log(o)})}stop(){le(this.simulationId).then(e=>{this.timer!=null&&(clearTimeout(this.timer),this.timer=0);const l=document.createElement("button");l.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(l),l.addEventListener("click",this.handleStartSimulation.bind(this),!1),this.getSnapshotControl.disableControl()}).catch(e=>{this.timer!=0&&(clearTimeout(this.timer),this.timer=0);const l=document.createElement("button");l.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(l),this.getSnapshotControl.disableControl(),console.error(e)})}enableControl(){console.log("enable"),this.disabled=!1,this.element.className="ol-control ctrl-start-simulation"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-start-simulation"}}class ce extends m{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Cancella griglia";const n=document.createElement("div");n.className="ol-control ol-control-disabled ctrl-delete-grid",n.appendChild(t);super({element:n,target:o.target});i(this,"map");i(this,"addMarker");i(this,"getGridController");this.addMarker=l,t.addEventListener("click",this.handleDeleteGrid.bind(this),!1)}handleDeleteGrid(){this.map.getLayers().getArray().filter(e=>e.get("id")==123).forEach(e=>this.map.removeLayer(e)),this.map.on("singleclick",this.addMarker),this.disableControl(),this.getGridController.disableControl()}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-delete-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-delete-grid"}}class de extends m{constructor(e){const l=e||{},o=document.createElement("div");o.className="ol-control ctrl-horizon",o.innerHTML='Horizon: <input type="range" min="'+10+'" max="'+2e3+'" value="50" class="slider" id="horizon">';const t=document.createElement("span");t.id="val",o.appendChild(t);super({element:o,target:l.target});i(this,"min",10);i(this,"max",2e3);i(this,"horizonSlider");i(this,"val");this.val=t,this.element=o}activateSlider(){this.horizonSlider=document.getElementById("horizon"),this.val.innerHTML=this.horizonSlider.value,this.horizonSlider.oninput=function(){document.getElementById("val").innerHTML=document.getElementById("horizon").value}}}class me extends m{constructor(e){const l=e||{},o=document.createElement("div");o.className="ol-control ol-control-disabled ctrl-get-snapshot",o.innerHTML='Snapshot: <input type="range" min="'+0+'" max="'+2e3+'" step="10" value="0" class="slider" id="elapsedminutes">';const t=document.createElement("span");t.id="val_em",o.appendChild(t);const n=document.createElement("button");n.innerHTML="Scarica snapshot",o.appendChild(n);super({element:o,target:l.target});i(this,"elapsedMinutesSlider");i(this,"simulationId");i(this,"elapsedminutes");i(this,"min",10);i(this,"max",2e3);i(this,"map");i(this,"disabled",!0);this.elapsedminutes=t,this.element=o,n.addEventListener("click",this.handleGetSnapshot.bind(this),!1)}handleGetSnapshot(){var e=new u({stroke:new h({color:"blue",width:1}),fill:new p}),l=function(o){var t=o.get("fire"),n="";return t==0?n="rgba(0, 0, 0, 0.1)":t==1?n="rgba(255, 0, 0, 0.3)":n="rgba(255, 255, 0, 0.3)",e.getFill().setColor(n),e};re(this.simulationId,this.elapsedminutes.innerHTML).then(o=>{var t=o.data;if(console.log("New grid from snapshot:"),console.log(t),t.features.length>0){const n=new E({features:new G().readFeatures(t)}),s=new M({source:n,style:l});s.set("id",123),this.map.getLayers().getArray().filter(d=>d.get("id")==123).forEach(d=>this.map.removeLayer(d)),this.map.addLayer(s)}}).catch(o=>{console.log(o)})}activateSlider(){this.elapsedMinutesSlider=document.getElementById("elapsedminutes"),this.elapsedminutes.innerHTML=this.elapsedMinutesSlider.value,this.elapsedMinutesSlider.oninput=function(){document.getElementById("val_em").innerHTML=document.getElementById("elapsedminutes").value}}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-get-snapshot"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-get-snapshot"}}let ue="3035",he="+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",w=[84.17,-35.58,24.6,44.83];const O="EPSG:"+ue,z=function(r){if(console.log("coordinates: "+r.coordinate),f<2){const e=new x({geometry:new j(r.coordinate),name:"Point"});e.setStyle(be),I.addFeature(e),H.setSource(I),H.set("id",456),f+=1,f==1?(c.x0=r.coordinate[0],c.y0=r.coordinate[1]):f==2&&(c.xn=r.coordinate[0],c.yn=r.coordinate[1],c.enableControl())}else f>=2&&(f=0,I.clear(),c.disableControl())};F.defs(O,he);J(F);const b=R(O),pe=q("EPSG:4326",b);let _=[w[1],w[2],w[3],w[0]];b.setWorldExtent(_);const A=K(_,pe,void 0,8);b.setExtent(A);let g=new ae,v=new ce("",z),c=new ie("",z,v),L=new se("",g),T=new de,k=new me;const a=new W({controls:Q().extend([c,v,L,g,T,k]),layers:[new X({source:new Y})],target:"map",view:new $({projection:b,center:[4559505,2121005],extent:A,zoom:16})});v.getGridController=c;v.map=a;c.map=a;g.map=a;k.map=a;T.activateSlider();g.horizonControl=T;g.getSnapshotControl=k;k.activateSlider();const C=new ee({trackingOptions:{enableHighAccuracy:!0},projection:b});C.setTracking(!0);const ge=new x;C.on("change:accuracyGeometry",function(){ge.setGeometry(C.getAccuracyGeometry())});const B=new x;B.setStyle(new u({image:new P({radius:6,fill:new p({color:"#3399CC"}),stroke:new h({color:"#fff",width:2})})}));C.on("change:position",function(){const r=C.getPosition();B.setGeometry(r?new j(r):null)});var N=a.getView().getZoom();console.log(N);a.on("moveend",function(r){var e=a.getView().getZoom();N!=e&&(console.log("zoom end, new zoom: "+e),N=e)});const fe=function(r){let e=a.getFeaturesAtPixel(r);e[0]!=null&&((e[0].getStyle()==null||e[0].getStyle()!=null&&e[0].getStyle().fill_.color_=="rgba(0, 0, 0, 0.1)")&&L.stack.push(e[0]),L.stack.length>0&&g.enableControl(),e[0].setStyle(new u({stroke:new h({color:"blue",width:1}),fill:new p({color:"rgba(255, 0, 0, 0.3)"})})),e[0].setProperties({fire:1}))};a.on("click",function(r){fe(r.pixel)});const V=new p({color:"rgba(255,255,255,0.4)"}),U=new h({color:"#3399CC",width:1.25}),be=new u({image:new P({fill:V,stroke:U,radius:5}),fill:V,stroke:U}),I=new E({features:[]}),H=new M;a.addLayer(H);let f=0;a.on("singleclick",z);
//# sourceMappingURL=index.96db5544.js.map
