var R=Object.defineProperty;var q=(i,e,l)=>e in i?R(i,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[e]=l;var s=(i,e,l)=>(q(i,typeof e!="symbol"?e+"":e,l),l);import{a as S,C as u,S as h,b as p,F as g,V as M,G,c as x,p as j,r as K,g as W,d as Q,e as X,M as Y,f as $,T as ee,O as te,h as ne,i as oe,j as T,k as O,P as A}from"./vendor.9e2f2b41.js";const le=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}};le();const w="http://localhost:4000";function ie(i,e,l,o){return S.get(w+"/grid/"+i+"/"+e+"/"+l+"/"+o)}function se(i){return S.post(w+"/start",i)}function re(i){var e="/stop";return S.post(w+e,{simulationId:i})}function ae(i,e){console.log(e),console.log(parseInt(e));var l="/snapshot/"+parseInt(i)+"/"+parseInt(e);return console.log(l),S.get(w+l)}class ce extends u{constructor(e,l,o){const t=e||{},n=document.createElement("button");n.innerHTML="Ottieni griglia";const r=document.createElement("div");r.className="ol-control ol-control-disabled ctrl-get-grid",r.appendChild(n);super({element:r,target:t.target});s(this,"x0",0);s(this,"y0",0);s(this,"xn",0);s(this,"yn",0);s(this,"map");s(this,"disabled",!0);s(this,"addMarker");s(this,"deleteGridController");this.addMarker=l,this.deleteGridController=o,n.addEventListener("click",this.handleGetGrid.bind(this),!1)}handleGetGrid(){const e={Polygon:new h({stroke:new p({color:"blue",width:1}),fill:new g({color:"rgba(0, 0, 0, 0.1)"})})},l=function(o){return e[o.getGeometry().getType()]};ie(this.x0,this.y0,this.xn,this.yn).then(o=>{var t=o.data;if(t.features.length==0)return;const n=new M({features:new G().readFeatures(t)}),r=new x({source:n,style:l});r.set("id",123),this.map.addLayer(r),this.map.un("singleclick",this.addMarker),this.map.getLayers().getArray().filter(a=>a.get("id")==456).forEach(a=>this.map.removeLayer(a)),this.deleteGridController.enableControl(),this.disableControl()}).catch(o=>{console.error(o)})}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-get-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-get-grid"}}class de extends u{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Pulisci";const n=document.createElement("div");n.className="ol-control ctrl-undo",n.appendChild(t);super({element:n,target:o.target});s(this,"stack",[]);s(this,"startSimulationController",0);this.startSimulationController=l,t.addEventListener("click",this.handleUndo.bind(this),!1)}handleUndo(){if(this.stack.length>0){console.log(this.stack);let e=this.stack.pop();console.log(this.stack),this.stack.length>0?this.startSimulationController.enableControl():this.startSimulationController.disableControl(),e.setStyle(new h({stroke:new p({color:"blue",width:1}),fill:new g({color:"rgba(0, 0, 0, 0.1)"})}))}else this.startSimulationController.disableControl()}}class me extends u{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Inizia simulazione";const n=document.createElement("div");n.className="ol-control ol-control-disabled ctrl-start-simulation",n.appendChild(t);super({element:n,target:o.target});s(this,"initState");s(this,"disabled",!0);s(this,"simulationId");s(this,"timer");s(this,"map");s(this,"horizonControl");s(this,"getSnapshotControl");this.element=n,this.horizonControl=l,t.addEventListener("click",this.handleStartSimulation.bind(this),!1)}handleStartSimulation(){var e=this.map.getLayers().getArray().filter(o=>o.get("id")==123)[0],l=JSON.parse(new G().writeFeatures(e.getSource().getFeatures()));l.horizon=this.horizonControl.val.innerHTML,se(l).then(o=>{console.log("Simulation started:"),console.log(o),this.simulationId=o.data;const t=document.createElement("button");t.innerHTML="Ferma simulazione",this.element.className="ol-control ctrl-stop-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(t),t.addEventListener("click",this.stop.bind(this),!1),this.getSnapshotControl.setSimulationId(this.simulationId),this.getSnapshotControl.max=this.horizonControl.val.innerHTML,this.getSnapshotControl.enableControl()}).catch(o=>{console.log(o)})}stop(){re(this.simulationId).then(e=>{this.timer!=null&&(clearTimeout(this.timer),this.timer=0);const l=document.createElement("button");l.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(l),l.addEventListener("click",this.handleStartSimulation.bind(this),!1)}).catch(e=>{this.timer!=0&&(clearTimeout(this.timer),this.timer=0);const l=document.createElement("button");l.innerHTML="Inizia simulazione",this.element.className="ol-control ctrl-start-simulation",this.element.removeChild(this.element.firstChild),this.element.appendChild(l),console.error(e)})}enableControl(){console.log("enable"),this.disabled=!1,this.element.className="ol-control ctrl-start-simulation"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-start-simulation"}}class ue extends u{constructor(e,l){const o=e||{},t=document.createElement("button");t.innerHTML="Cancella griglia";const n=document.createElement("div");n.className="ol-control ol-control-disabled ctrl-delete-grid",n.appendChild(t);super({element:n,target:o.target});s(this,"map");s(this,"addMarker");s(this,"getGridController");this.addMarker=l,t.addEventListener("click",this.handleDeleteGrid.bind(this),!1)}handleDeleteGrid(){this.map.getLayers().getArray().filter(e=>e.get("id")==123).forEach(e=>this.map.removeLayer(e)),this.map.on("singleclick",this.addMarker),this.disableControl(),this.getGridController.disableControl()}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-delete-grid"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-delete-grid"}}class he extends u{constructor(e){const l=e||{},o=document.createElement("div");o.className="ol-control ctrl-horizon",o.innerHTML='Horizon: <input type="range" min="'+100+'" max="'+2e4+'" step="100" value="50" class="slider" id="horizon">';const t=document.createElement("span");t.id="val",o.appendChild(t);super({element:o,target:l.target});s(this,"horizonSlider");s(this,"val");this.val=t,this.element=o}activateSlider(){this.horizonSlider=document.getElementById("horizon"),this.val.innerHTML=this.horizonSlider.value,this.horizonSlider.oninput=function(){document.getElementById("val").innerHTML=document.getElementById("horizon").value}}}class pe extends u{constructor(e){const l=e||{};let o="nessuno";const t=document.createElement("div");t.className="ol-control ol-control-disabled ctrl-get-snapshot",t.innerHTML='<p id="simid">Simulation id: '+o+"</p>";const n=document.createElement("button");n.innerHTML="+",n.id="plus";const r=document.createElement("button");r.innerHTML="-",r.id="minus";const a=document.createElement("span");a.id="val_em",a.innerHTML=0;const _=document.createElement("span");_.innerHTML="Minuti: ";const m=document.createElement("div");m.className="",m.appendChild(_),m.appendChild(r),m.appendChild(a),m.appendChild(n),t.appendChild(m);const k=document.createElement("button");k.innerHTML="Scarica snapshot",t.appendChild(k);super({element:t,target:l.target});s(this,"simulationId","nessuno");s(this,"elapsedminutes");s(this,"map");s(this,"disabled",!0);s(this,"max",20);this.elapsedminutes=0,this.val=a,this.element=t,this.simulationId=o,k.addEventListener("click",this.handleGetSnapshot.bind(this),!1),n.addEventListener("click",this.incrementMinutes.bind(this),!1),r.addEventListener("click",this.decrementMinutes.bind(this),!1)}handleGetSnapshot(){var e=new h({stroke:new p({color:"blue",width:1}),fill:new g}),l=function(o){var t=o.get("fire"),n="";return t==0?n="rgba(0, 0, 0, 0.1)":t==1?n="rgba(255, 0, 0, 0.3)":n="rgba(255, 255, 0, 0.3)",e.getFill().setColor(n),e};ae(this.simulationId,this.elapsedminutes).then(o=>{var t=o.data;if(console.log("New grid from snapshot:"),console.log(t),t.features.length>0){const n=new M({features:new G().readFeatures(t)}),r=new x({source:n,style:l});r.set("id",123),this.map.getLayers().getArray().filter(a=>a.get("id")==123).forEach(a=>this.map.removeLayer(a)),this.map.addLayer(r)}}).catch(o=>{console.log(o)})}incrementMinutes(){console.log("inc"),this.elapsedminutes<this.max&&(this.elapsedminutes+=10,this.val.innerHTML=this.elapsedminutes)}decrementMinutes(){this.elapsedminutes>0&&(this.elapsedminutes-=10,this.val.innerHTML=this.elapsedminutes)}setMax(e){this.elapsedMinutesSlider.max=e}setSimulationId(e){this.simulationId=e,document.getElementById("simid").innerHTML='<p id="simid">Simulation id: '+this.simulationId+"</p>"}enableControl(){this.disabled=!1,this.element.className="ol-control ctrl-get-snapshot"}disableControl(){this.disabled=!0,this.element.className="ol-control ol-control-disabled ctrl-get-snapshot"}}let ge="3035",fe="+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",v=[84.17,-35.58,24.6,44.83];const V="EPSG:"+ge,z=function(i){if(console.log("coordinates: "+i.coordinate),b<2){const e=new T({geometry:new A(i.coordinate),name:"Point"});e.setStyle(Se),F.addFeature(e),P.setSource(F),P.set("id",456),b+=1,b==1?(d.x0=i.coordinate[0],d.y0=i.coordinate[1]):b==2&&(d.xn=i.coordinate[0],d.yn=i.coordinate[1],d.enableControl())}else b>=2&&(b=0,F.clear(),d.disableControl())};j.defs(V,fe);K(j);const C=W(V),be=Q("EPSG:4326",C);let B=[v[1],v[2],v[3],v[0]];C.setWorldExtent(B);const U=X(B,be,void 0,8);C.setExtent(U);let f=new me,L=new ue("",z),d=new ce("",z,L),E=new de("",f),H=new he,I=new pe;const c=new Y({controls:$().extend([d,L,E,f,H,I]),layers:[new ee({source:new te})],target:"map",view:new ne({projection:C,center:[4559505,2121005],extent:U,zoom:16})});L.getGridController=d;L.map=c;d.map=c;f.map=c;I.map=c;H.activateSlider();f.horizonControl=H;f.getSnapshotControl=I;const y=new oe({trackingOptions:{enableHighAccuracy:!0},projection:C});y.setTracking(!0);const Ce=new T;y.on("change:accuracyGeometry",function(){Ce.setGeometry(y.getAccuracyGeometry())});const Z=new T;Z.setStyle(new h({image:new O({radius:6,fill:new g({color:"#3399CC"}),stroke:new p({color:"#fff",width:2})})}));y.on("change:position",function(){const i=y.getPosition();Z.setGeometry(i?new A(i):null)});var N=c.getView().getZoom();console.log(N);c.on("moveend",function(i){var e=c.getView().getZoom();N!=e&&(console.log("zoom end, new zoom: "+e),N=e)});const ye=function(i){let e=c.getFeaturesAtPixel(i);e[0]!=null&&((e[0].getStyle()==null||e[0].getStyle()!=null&&e[0].getStyle().fill_.color_=="rgba(0, 0, 0, 0.1)")&&E.stack.push(e[0]),E.stack.length>0&&f.enableControl(),e[0].setStyle(new h({stroke:new p({color:"blue",width:1}),fill:new g({color:"rgba(255, 0, 0, 0.3)"})})),e[0].setProperties({fire:1}))};c.on("click",function(i){ye(i.pixel)});const D=new g({color:"rgba(255,255,255,0.4)"}),J=new p({color:"#3399CC",width:1.25}),Se=new h({image:new O({fill:D,stroke:J,radius:5}),fill:D,stroke:J}),F=new M({features:[]}),P=new x;c.addLayer(P);let b=0;c.on("singleclick",z);
//# sourceMappingURL=index.66e5bca0.js.map
